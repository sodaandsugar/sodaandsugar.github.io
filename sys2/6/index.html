
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../5/">
      
      
        <link rel="next" href="../7/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Chapter 6 Structures - sodasugar的笔记本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-6-structures" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="sodasugar的笔记本" class="md-header__button md-logo" aria-label="sodasugar的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            sodasugar的笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 6 Structures
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="sodasugar的笔记本" class="md-nav__button md-logo" aria-label="sodasugar的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    sodasugar的笔记本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    通识课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            通识课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    大物乙Ⅱ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            大物乙Ⅱ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/%E7%89%A9%E7%90%86%E5%AD%A6%E5%8D%95%E4%BD%8D%E6%8D%A2%E7%AE%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    物理学单位换算
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter1_%E9%9D%99%E7%94%B5%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1 静电场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter2_%E9%9D%99%E7%94%B5%E5%9C%BA%E4%B8%AD%E7%9A%84%E5%AF%BC%E4%BD%93%E5%92%8C%E7%94%B5%E4%BB%8B%E8%B4%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2 静电场中的导体和电介质
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter3_%E7%94%B5%E6%B5%81%E5%92%8C%E7%A3%81%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3 电流和磁场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter4_%E7%89%A9%E8%B4%A8%E4%B8%AD%E7%9A%84%E7%A3%81%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4 物质中的磁场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter5_%E7%94%B5%E7%A3%81%E6%84%9F%E5%BA%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5 电磁感应
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter6_%E9%BA%A6%E5%85%8B%E6%96%AF%E9%9F%A6%E6%96%B9%E7%A8%8B%E4%B8%8E%E7%94%B5%E7%A3%81%E6%B3%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6 麦克斯韦方程与电磁波
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter7_%E5%85%89%E7%9A%84%E5%B9%B2%E6%B6%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7 光的干涉
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter8_%E5%85%89%E7%9A%84%E8%A1%8D%E5%B0%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8 光的衍射
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter9_%E5%85%89%E7%9A%84%E5%81%8F%E6%8C%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 9 光的偏振
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 10 光的量子论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 11 玻尔的原子模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 12 量子力学初步
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/midterm_review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中小结
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    专业课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            专业课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    数据安全与密码学基础
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            数据安全与密码学基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/resource/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    资源索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1 概论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2 完善保密加密
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3 对称密钥加密以及伪随机性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4 消息鉴别码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5 哈希函数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/midterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中考试卷
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            高级数据结构与算法分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/resource/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    资源索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    题目集
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            题目集
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AVL 树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Splay 树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    摊还分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    红黑树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    B+ 树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    倒排索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    左偏堆
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    斜堆
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    二项队列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    回溯
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分治法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    动态规划
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    贪心算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P/NP 问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    近似算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    局部搜索
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    随机算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并行算法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中考 cheat sheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/midterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中考试
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    计算机系统Ⅱ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            计算机系统Ⅱ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1 ISA Review
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2 Design of Pipelining
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3 Hazard of Pipelining
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4 Software-Hardware Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5 Intro&Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 6 Structures
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 6 Structures
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-operating-system-services" class="md-nav__link">
    <span class="md-ellipsis">
      1 Operating System Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-user-and-operating-system-interface" class="md-nav__link">
    <span class="md-ellipsis">
      2 User and Operating System-Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-system-calls" class="md-nav__link">
    <span class="md-ellipsis">
      3 System Calls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 System Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1" class="md-nav__link">
    <span class="md-ellipsis">
      3. 1 基础知识
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 2 参数传递
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 3 系统调用类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-system-services" class="md-nav__link">
    <span class="md-ellipsis">
      4 System Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-linkers-and-loaders" class="md-nav__link">
    <span class="md-ellipsis">
      5 Linkers and Loaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 Linkers and Loaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-1" class="md-nav__link">
    <span class="md-ellipsis">
      5. 1 基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-2-elf-executable-and-linkable-format" class="md-nav__link">
    <span class="md-ellipsis">
      5. 2 ELF 二进制文件基础（Executable and Linkable Format）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-static-linkdynamic-link" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3 静态链接（Static link）与动态链接（Dynamic link）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-os-design-and-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      6 OS Design and Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 OS Design and Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6-1" class="md-nav__link">
    <span class="md-ellipsis">
      6. 1 设计目标与规范
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-2" class="md-nav__link">
    <span class="md-ellipsis">
      6. 2 实现语言
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-operating-system-structure" class="md-nav__link">
    <span class="md-ellipsis">
      7 Operating System Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-building-and-booting-an-operating-system" class="md-nav__link">
    <span class="md-ellipsis">
      8 Building and Booting an Operating System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 Building and Booting an Operating System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8-1-linux" class="md-nav__link">
    <span class="md-ellipsis">
      8. 1 构建流程（以 Linux 为例）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-2" class="md-nav__link">
    <span class="md-ellipsis">
      8. 2 启动流程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-operating-system-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      9 Operating System Debugging
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7 Processes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8 CPU Scheduling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    选修课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            选修课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    英语口译
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            英语口译
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 Ceremonial Speech
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Tourism
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 Culture and Education
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课堂文本
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-operating-system-services" class="md-nav__link">
    <span class="md-ellipsis">
      1 Operating System Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-user-and-operating-system-interface" class="md-nav__link">
    <span class="md-ellipsis">
      2 User and Operating System-Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-system-calls" class="md-nav__link">
    <span class="md-ellipsis">
      3 System Calls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 System Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1" class="md-nav__link">
    <span class="md-ellipsis">
      3. 1 基础知识
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 2 参数传递
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 3 系统调用类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-system-services" class="md-nav__link">
    <span class="md-ellipsis">
      4 System Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-linkers-and-loaders" class="md-nav__link">
    <span class="md-ellipsis">
      5 Linkers and Loaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 Linkers and Loaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-1" class="md-nav__link">
    <span class="md-ellipsis">
      5. 1 基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-2-elf-executable-and-linkable-format" class="md-nav__link">
    <span class="md-ellipsis">
      5. 2 ELF 二进制文件基础（Executable and Linkable Format）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-static-linkdynamic-link" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3 静态链接（Static link）与动态链接（Dynamic link）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-os-design-and-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      6 OS Design and Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 OS Design and Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6-1" class="md-nav__link">
    <span class="md-ellipsis">
      6. 1 设计目标与规范
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-2" class="md-nav__link">
    <span class="md-ellipsis">
      6. 2 实现语言
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-operating-system-structure" class="md-nav__link">
    <span class="md-ellipsis">
      7 Operating System Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-building-and-booting-an-operating-system" class="md-nav__link">
    <span class="md-ellipsis">
      8 Building and Booting an Operating System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 Building and Booting an Operating System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8-1-linux" class="md-nav__link">
    <span class="md-ellipsis">
      8. 1 构建流程（以 Linux 为例）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-2" class="md-nav__link">
    <span class="md-ellipsis">
      8. 2 启动流程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-operating-system-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      9 Operating System Debugging
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-6-structures">Chapter 6 Structures<a class="headerlink" href="#chapter-6-structures" title="Permanent link">&para;</a></h1>
<h2 id="1-operating-system-services">1 Operating System Services<a class="headerlink" href="#1-operating-system-services" title="Permanent link">&para;</a></h2>
<p><img src="/sys2/images/image6-1.png" style="display: block; width: 85%; margin: 0 auto;" /></p>
<details class="abstract">
<summary>详解</summary>
<table>
<thead>
<tr>
<th>OS Services</th>
<th>Features</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>program execution</strong></td>
<td>加载并运行程序，支持正常终止和异常终止（返回错误码）</td>
</tr>
<tr>
<td><strong>I/O operations</strong></td>
<td>允许程序访问 I/O 设备（键盘、磁盘等），管理设备读写</td>
</tr>
<tr>
<td><strong>file systems</strong></td>
<td>提供文件/目录的抽象层，允许程序执行创建/删除/读写，实现权限管理</td>
</tr>
<tr>
<td><strong>communication</strong></td>
<td>支持进程间信息交换，包括共享内存、消息传递两种模型</td>
</tr>
<tr>
<td><strong>error detection</strong></td>
<td>监控 CPU、内存、I/O 及用户程序的错误，触发相应处理机制</td>
</tr>
<tr>
<td><strong>resource allocation</strong></td>
<td>决定 CPU、内存、I/O 等资源的分配策略</td>
</tr>
<tr>
<td><strong>accounting</strong></td>
<td>跟踪用户/进程的资源使用情况，支持设置使用限制，用于统计分析</td>
</tr>
<tr>
<td><strong>protection and security</strong></td>
<td>控制资源访问权限，强制用户认证，保护用户数据安全</td>
</tr>
</tbody>
</table>
</details>
<h2 id="2-user-and-operating-system-interface">2 User and Operating System-Interface<a class="headerlink" href="#2-user-and-operating-system-interface" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>命令行接口（Command line interface, CLI）</strong></p>
<ul>
<li>又称<strong>命令解释器（command interpreter）</strong>，<strong>支持直接输入命令</strong></li>
<li>可在内核中实现，也可通过系统程序实现</li>
<li>有多种实现形态，即 shell</li>
<li>主要功能是从用户处获取命令并执行</li>
<li>命令可内置或仅作为程序名称，后者新增功能无需修改 shell</li>
</ul>
</li>
<li>
<p><strong>图形用户接口（Graphical User Interface, GUI）</strong></p>
<ul>
<li>桌面隐喻，使用鼠标、键盘和显示器进行操作，用图标表示文件、程序、操作等对象</li>
</ul>
<details class="example">
<summary>示例</summary>
<table>
<thead>
<tr>
<th>系统</th>
<th>接口情况</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Windows</strong></td>
<td>带有 CLI 命令 Shell 的 GUI 系统</td>
</tr>
<tr>
<td><strong>Mac OS X</strong></td>
<td>采用 Aqua GUI 界面，底层基于 UNIX 内核，支持 Shell</td>
</tr>
<tr>
<td><strong>Unix/Linux</strong></td>
<td>以 CLI 为基础，支持可选的 GUI 界面（如 CDE、KDE、GNOME）</td>
</tr>
</tbody>
</table>
</details>
</li>
<li>
<p><strong>触摸屏接口（Touchscreen Interfaces）</strong></p>
<ul>
<li>适配场景：无鼠标设备或触控需求</li>
<li>操作方式：手势识别、虚拟键盘输入、语音命令</li>
</ul>
</li>
</ol>
<h2 id="3-system-calls">3 System Calls<a class="headerlink" href="#3-system-calls" title="Permanent link">&para;</a></h2>
<h3 id="3-1">3. 1 基础知识<a class="headerlink" href="#3-1" title="Permanent link">&para;</a></h3>
<ul>
<li>用于访问操作系统所提供服务的编程接口，通常用高级语言（C 或 C++）实现</li>
<li>通过高层应用程序编程接口（API）访问，而非直接调用</li>
</ul>
<details class="info">
<summary>syscall_table</summary>
<table>
<thead>
<tr>
<th>Syscall No.</th>
<th>Name</th>
<th>Entry point</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>read</td>
<td>sys_read</td>
<td>fs/read_write.c</td>
</tr>
<tr>
<td>1</td>
<td>write</td>
<td>sys_write</td>
<td>fs/read_write.c</td>
</tr>
<tr>
<td>2</td>
<td>open</td>
<td>sys_open</td>
<td>fs/open.c</td>
</tr>
<tr>
<td>3</td>
<td>close</td>
<td>sys_close</td>
<td>fs/open.c</td>
</tr>
<tr>
<td>4</td>
<td>stat</td>
<td>sys_newstat</td>
<td>fs/stat.c</td>
</tr>
<tr>
<td>5</td>
<td>fstat</td>
<td>sys_newfstat</td>
<td>fs/stat.c</td>
</tr>
</tbody>
</table>
</details>
<details class="example">
<summary>x86_64 架构下 <code>write()</code> 系统调用的执行流程</summary>
<p><img src="/sys2/images/image6-2.png" style="display: block; width: 40%; margin: 0 auto;" /></p>
<ol>
<li>
<p>用户代码调用 <code>libc</code>（C 标准库）提供的包装函数 <code>write</code>，<code>main</code> 函数通过 <code>call 442e60 &lt;__libc_write&gt;</code> 调用 <code>libc</code> 封装的 <code>__libc_write</code> 函数，此时 <code>%rdi/%rsi/%rdx</code> 已带齐 3 个参数</p>
<div class="highlight"><pre><span></span><code><span class="err">00000000004018</span><span class="nf">b5</span><span class="w"> </span><span class="err">&lt;</span><span class="no">main</span><span class="err">&gt;</span><span class="p">:</span>
<span class="err">4018</span><span class="nl">b5:</span><span class="w"> </span><span class="nf">f3</span><span class="w"> </span><span class="mi">0</span><span class="no">f</span><span class="w"> </span><span class="mi">1</span><span class="no">e</span><span class="w"> </span><span class="no">fa</span><span class="w">          </span><span class="no">endbr64</span>
<span class="err">4018</span><span class="nl">b9:</span><span class="w"> </span><span class="err">55</span><span class="w">                    </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbp</span><span class="w">                 </span><span class="c1"># 保存上一层函数的栈基址到当前栈中</span>
<span class="err">4018</span><span class="nl">ba:</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e5</span><span class="w">              </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rbp</span><span class="w">            </span><span class="c1"># 建立当前函数的栈帧</span>
<span class="err">4018</span><span class="nl">bd:</span><span class="w"> </span><span class="nf">ba</span><span class="w"> </span><span class="mi">0</span><span class="no">d</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">        </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xd</span><span class="p">,</span><span class="nv">%edx</span><span class="w">            </span><span class="c1"># 写入长度</span>
<span class="err">4018</span><span class="nl">c2:</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">3</span><span class="no">b</span><span class="w"> </span><span class="no">b7</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x8b73b</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span><span class="nv">%rsi</span><span class="w">   </span><span class="c1"># 字符串缓冲区地址</span>
<span class="err">4018</span><span class="nl">c9:</span><span class="w"> </span><span class="nf">bf</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">        </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%edi</span><span class="w">            </span><span class="c1"># 文件描述符 fd=1，stdout 标准输出</span>
<span class="err">4018</span><span class="nl">ce:</span><span class="w"> </span><span class="nf">e8</span><span class="w"> </span><span class="mi">8</span><span class="no">d</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w">        </span><span class="no">call</span><span class="w">   </span><span class="mh">442e60</span> <span class="p">&lt;</span><span class="no">__libc_write</span><span class="p">&gt;</span>
<span class="err">4018</span><span class="nl">d3:</span><span class="w"> </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">        </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">            </span><span class="c1"># 函数返回值</span>
<span class="err">4018</span><span class="nl">d8:</span><span class="w"> </span><span class="err">5</span><span class="nf">d</span><span class="w">                    </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbp</span><span class="w">                 </span><span class="c1"># 栈帧销毁，恢复上一层函数的栈基址</span>
<span class="err">4018</span><span class="nl">d9:</span><span class="w"> </span><span class="nf">c3</span><span class="w">                    </span><span class="no">ret</span>
<span class="err">4018</span><span class="nl">da:</span><span class="w"> </span><span class="err">66</span><span class="w"> </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="mi">1</span><span class="no">f</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">     </span><span class="no">nopw</span><span class="w">   </span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>把 <code>write</code> 对应的系统调用号（x86_64 中为 <code>0x1</code>）** 存入 <code>%eax</code>，然后执行 <code>syscall</code> 指令，从用户态切换到内核态（类似 32位 x86 的 <code>int $0x80</code>、ARM64 的 <code>svc</code>）</p>
<div class="highlight"><pre><span></span><code><span class="err">0000000000442</span><span class="nf">e60</span><span class="w"> </span><span class="err">&lt;</span><span class="no">__libc_write</span><span class="err">&gt;</span><span class="p">:</span>
<span class="err">442</span><span class="nl">e60:</span><span class="w"> </span><span class="nf">f3</span><span class="w"> </span><span class="mi">0</span><span class="no">f</span><span class="w"> </span><span class="mi">1</span><span class="no">e</span><span class="w"> </span><span class="no">fa</span><span class="w">          </span><span class="no">endbr64</span>
<span class="err">442</span><span class="nl">e64:</span><span class="w"> </span><span class="err">64</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="no">mov</span><span class="w">    </span><span class="nv">%fs</span><span class="p">:</span><span class="mi">0x18</span><span class="p">,</span><span class="nv">%eax</span><span class="w">  </span>
<span class="w">        </span><span class="mi">00</span><span class="w">                    </span>
<span class="mi">442</span><span class="no">e6c</span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="no">c0</span><span class="w">                 </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span>
<span class="err">442</span><span class="nl">e6e:</span><span class="w"> </span><span class="err">75</span><span class="w"> </span><span class="err">10</span><span class="w">                 </span><span class="nf">jne</span><span class="w">    </span><span class="mh">442e80</span> <span class="p">&lt;</span><span class="no">__libc_write</span><span class="p">+</span><span class="mi">0x20</span><span class="p">&gt;</span><span class="w">  </span>
<span class="mi">442</span><span class="no">e70</span><span class="p">:</span><span class="w"> </span><span class="no">b8</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">        </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="err">442</span><span class="nl">e75:</span><span class="w"> </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="mi">05</span><span class="w">                 </span><span class="no">syscall</span>
<span class="err">442</span><span class="nl">e77:</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">3</span><span class="nf">d</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="no">f0</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">     </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0xfffffffffffff000</span><span class="p">,</span><span class="nv">%rax</span><span class="w">  </span>
<span class="mi">442</span><span class="no">e7d</span><span class="p">:</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">51</span><span class="w">                 </span><span class="no">ja</span><span class="w">     </span><span class="mh">442ed0</span> <span class="p">&lt;</span><span class="no">__libc_write</span><span class="p">+</span><span class="mi">0x70</span><span class="p">&gt;</span>
<span class="err">442</span><span class="nl">e7f:</span><span class="w"> </span><span class="nf">c3</span><span class="w">                    </span><span class="no">ret</span>
<span class="err">442</span><span class="nl">e80:</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">28</span><span class="w">           </span><span class="no">sub</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>进入内核态的处理流程</p>
<ol>
<li>内核执行 <code>kernel_entry</code> 代码，保存用户态的寄存器，即保存用户上下文</li>
<li>查询 <code>syscall_table</code>，找到系统调用的实际处理函数并调用对应的内核函数</li>
</ol>
</li>
<li>
<p>写操作完成后，内核执行 <code>ret_to_user</code>，恢复用户上下文并切回用户态继续执行</p>
</li>
</ol>
<p><img src="/sys2/images/image6-3.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
</details>
<div class="admonition info">
<p class="admonition-title">运行时环境（Run-time Environment, RTE）</p>
<ul>
<li>运行特定编程语言编写的应用程序所需的全套软件，包括该语言的编译器/解释器，以及库、加载器等其他软件</li>
<li>提供了一个<strong>系统调用接口</strong>，该接口会拦截 API 中的函数调用，并在操作系统内部调用必要的系统调用</li>
</ul>
</div>
<details class="example">
<summary>系统调用示例 <code>cp in.txt out.txt</code></summary>
<p><img src="/sys2/images/image6-4.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
</details>
<ul>
<li><code>strace</code>（Linux）和 <code>dtruss</code>（Mac OS X）可以跟踪程序执行过程中的系统调用，支持统计调用次数、附加到运行中进程</li>
</ul>
<details class="question">
<summary>用 <code>cp</code> 命令复制一个大文件时，<code>strace</code> 可以观察到什么？</summary>
<p>由于大文件无法一次性载入内存，程序会进行大量的系统调用，出现 <code>read()</code> 和 <code>write()</code> 的高频循环</p>
</details>
<details class="info">
<summary>标准 API 示例：以 <code>read()</code> 函数为例</summary>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">ssize_t</span><span class="w">  </span><span class="n">read</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="err">┕━━━━━┙</span><span class="w">  </span><span class="err">┕━━┙</span><span class="w">   </span><span class="err">┕━━━━━━━━━━━━━━━━━━━━┙</span>
<span class="w"> </span><span class="n">返回值</span><span class="w">  </span><span class="n">函数名</span><span class="w">         </span><span class="n">参数</span>
</code></pre></div>
<p>读取成功时，返回实际读取的字节数；返回值 <code>0</code> 表示已到达文件末尾；若发生错误，<code>read()</code> 会返回 <code>-1</code></p>
</details>
<ul>
<li><code>time</code> 命令是一种简单的程序执行计时方式，其精度和分辨率不算高，会报告三种时间：<ul>
<li>real 时间：挂钟时间（也称为流逝时间、执行时间、运行时间等）</li>
<li>user 时间：在用户代码中消耗的时间（用户态）</li>
<li>system 时间：在系统调用中消耗的时间（内核态）</li>
</ul>
</li>
</ul>
<h3 id="3-2">3. 2 参数传递<a class="headerlink" href="#3-2" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>系统调用参数传递的三种方法</p>
<ul>
<li>通过<strong>寄存器传递</strong>参数（有时参数数量可能会超过寄存器的可用数量）</li>
<li>
<p>将参数存储在内存的一个<strong>块（或表）</strong>中，再将该块的地址通过寄存器作为参数传递</p>
<p><img src="/sys2/images/image6-5.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
</li>
<li>
<p>由程序将参数入<strong>栈</strong>，再由操作系统从栈中出栈获取参数</p>
</li>
</ul>
</li>
<li>
<p>块传递和栈传递的方法不会限制所传递参数的数量或长度</p>
</li>
<li>Linux 采用了寄存器传递与块传递相结合的方式</li>
</ul>
<h3 id="3-3">3. 3 系统调用类型<a class="headerlink" href="#3-3" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>系统调用类型</th>
<th>主要功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Process control</strong></td>
<td>创建/终止进程、结束、异常终止、加载/执行程序、获取/设置进程属性、等待指定时间、等待事件、发送事件信号、内存分配/释放、出错时转储内存、<strong>调试支持</strong>、<strong>单步执行</strong>、用于管理进程间共享数据访问的<strong>锁</strong></td>
</tr>
<tr>
<td><strong>File management</strong></td>
<td>创建/删除文件、打开/关闭文件、读取/写入/定位文件、获取/设置文件属性</td>
</tr>
<tr>
<td><strong>Device management</strong></td>
<td>请求/释放设备、读取/写入/定位设备数据、获取/设置设备属性、连接/断开设备</td>
</tr>
<tr>
<td><strong>Information maintenance</strong></td>
<td>获取/设置时间和日期、获取/设置系统数据、获取/设置进程、文件或设备属性</td>
</tr>
<tr>
<td><strong>Communications</strong></td>
<td>创建/删除通信连接、<strong>从客户端到服务器</strong>向<strong>主机名</strong>或<strong>进程名</strong>收发消息（若采用<strong>消息传递模型</strong>）、<strong>共享内存模型</strong>（创建并获取对内存区域的访问权限）、连接/断开远程设备</td>
</tr>
<tr>
<td><strong>Protection</strong></td>
<td>资源访问控制、权限管理、用户访问授权</td>
</tr>
</tbody>
</table>
<h2 id="4-system-services">4 System Services<a class="headerlink" href="#4-system-services" title="Permanent link">&para;</a></h2>
<ul>
<li>为程序的开发与执行提供便捷的环境，其中一部分只是系统调用的用户接口，另一部分则复杂得多</li>
</ul>
<table>
<thead>
<tr>
<th>系统服务</th>
<th>主要功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>File management</strong></td>
<td>创建、删除、复制、重命名、打印、转储、列出文件及目录</td>
</tr>
<tr>
<td><strong>Status information</strong></td>
<td><span class="arithmatex">\(\textbf{·}\)</span> 查询日期、时间、可用内存大小、磁盘空间、用户数量 <br> <span class="arithmatex">\(\textbf{·}\)</span> 查询详细性能、日志记录与调试信息 <br> <span class="arithmatex">\(\textbf{·}\)</span> 通常会将输出格式化并打印到终端或其他输出设备上 <br> <span class="arithmatex">\(\textbf{·}\)</span> 部分系统会实现<strong>注册表（registry）</strong>，用于存储和检索配置信息</td>
</tr>
<tr>
<td><strong>File modification</strong></td>
<td><span class="arithmatex">\(\textbf{·}\)</span> 用于创建和修改文件的文本编辑器 <br> <span class="arithmatex">\(\textbf{·}\)</span> 用于搜索文件内容或对文本进行转换的专用命令</td>
</tr>
<tr>
<td><strong>Programming-language support</strong></td>
<td>提供编译器、汇编器、调试器和解释器</td>
</tr>
<tr>
<td><strong>Program loading and execution</strong></td>
<td>包含绝对加载器、可重定位加载器、链接编辑器、覆盖加载器，以及针对高级语言和机器语言的调试系统</td>
</tr>
<tr>
<td><strong>Communications</strong></td>
<td><span class="arithmatex">\(\textbf{·}\)</span> 提供在进程、用户与计算机系统之间建立虚拟连接的机制 <br> <span class="arithmatex">\(\textbf{·}\)</span> 允许用户向彼此的屏幕发送消息、浏览网页、发送电子邮件、远程登录，以及在不同机器之间传输文件</td>
</tr>
<tr>
<td><strong>Background Services</strong></td>
<td><span class="arithmatex">\(\textbf{·}\)</span> 开机启动：有些用于系统启动流程，完成后即终止；有些从系统启动持续运行到关机 <br> <span class="arithmatex">\(\textbf{·}\)</span> 提供磁盘检查、进程调度、错误日志记录、打印等功能 <br> <span class="arithmatex">\(\textbf{·}\)</span> 运行在用户上下文（而非内核上下文）中 <br> <span class="arithmatex">\(\textbf{·}\)</span> 被称为<strong>服务（services）、子系统（subsystems）、守护进程（daemons）</strong></td>
</tr>
<tr>
<td><strong>Application programs</strong></td>
<td>与系统无关，由用户运行，通常不被视为操作系统的一部分，可通过命令行、鼠标点击、手指触屏点击等方式启动</td>
</tr>
</tbody>
</table>
<h2 id="5-linkers-and-loaders">5 Linkers and Loaders<a class="headerlink" href="#5-linkers-and-loaders" title="Permanent link">&para;</a></h2>
<h3 id="5-1">5. 1 基本概念<a class="headerlink" href="#5-1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>可重定位目标文件（relocatable object file）</strong>：源代码经编译后生成的可加载至任意物理内存位置的目标文件</li>
<li><strong>链接器（Linker）</strong>：将多个目标文件（.o）及依赖库合并为单个二进制可执行文件，完成地址重定位</li>
<li><strong>加载器（Loader）</strong>：将可执行文件从磁盘加载到内存并分配最终内存地址</li>
</ul>
<details class="info">
<summary>流程示意图</summary>
<p><img src="/sys2/images/image6-6.png" style="display: block; width: 50%; margin: 0 auto;" /></p>
</details>
<ul>
<li>现代系统不将库文件直接链接到可执行文件中，而是按需加载<strong>动态链接库</strong>（在 Windows 中称为 DLL），由所有使用同一版本该库的程序共享（仅加载一次）</li>
</ul>
<h3 id="5-2-elf-executable-and-linkable-format">5. 2 ELF 二进制文件基础（Executable and Linkable Format）<a class="headerlink" href="#5-2-elf-executable-and-linkable-format" title="Permanent link">&para;</a></h3>
<details class="quote">
<summary>常见命令</summary>
<ul>
<li><code>readelf -S a.out</code>：查看可执行文件 <code>a.out</code> 的所有段（Sections）</li>
<li><code>readelf -h a.out</code>：读取并显示 <code>a.out</code> 的文件头（Header）</li>
<li><code>objdump -d a.out</code>：对 <code>a.out</code> 进行反汇编（Disassemble）</li>
</ul>
</details>
<ul>
<li>核心结构：ELF 头、程序头表（供加载器使用）、段头表（供链接器使用）</li>
<li>
<p>关键段功能：</p>
<ul>
<li><code>.text</code>：存放可执行代码</li>
<li><code>.rodata</code>：存放常量等已初始化的只读数据(如 <code>static const</code>)</li>
<li><code>.data</code>：存放已初始化的全局变量、静态变量（如 <code>static int x = 10</code>）</li>
<li><code>.bss</code>：存放未初始化的全局变量、静态变量（如 <code>static int x</code>）</li>
</ul>
<details class="info">
<summary>ELF 文件的内部结构示意图</summary>
<p><img src="/sys2/images/image6-7.png" style="display: block; width: 40%; margin: 0 auto;" /></p>
</details>
</li>
<li>
<p>设置 ELF 文件的内存映射</p>
<ul>
<li>内核：将 ELF 段映射到进程虚拟地址空间；初始化栈（存储参数、环境变量）与堆（动态内存基础）</li>
<li>加载器（动态链接场景）：映射依赖库、解析符号、完成重定位</li>
</ul>
<details class="info">
<summary>程序运行时的内存布局示意图</summary>
<p><img src="/sys2/images/image6-8.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
<ul>
<li><strong>Kernel space</strong>：高地址，用户态不可访问</li>
<li><strong>Stack</strong>：函数调用栈，向下增长（存储局部变量、函数参数、返回地址）</li>
<li><strong>Memory Mapping Segment</strong>：文件映射（含动态库）、匿名映射</li>
<li><strong>Heap</strong>：动态内存分配区域，向上增长</li>
</ul>
</details>
</li>
</ul>
<h3 id="5-3-static-linkdynamic-link">5. 3 静态链接（Static link）与动态链接（Dynamic link）<a class="headerlink" href="#5-3-static-linkdynamic-link" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th></th>
<th>静态链接</th>
<th>动态链接</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>文件体积</strong></td>
<td>所有代码（含依赖库）打包进单个二进制可执行文件，体积大</td>
<td>仅打包自身代码，复用系统库文件，ELF 文件体积小</td>
</tr>
<tr>
<td><strong>加载器依赖</strong></td>
<td>无需动态加载器</td>
<td>依赖动态加载器（如<code>/lib64/ld-linux-x86-64.so.2</code>）</td>
</tr>
<tr>
<td><strong><code>.interp</code> 段</strong></td>
<td>无（无需指定动态链接器路径）</td>
<td>有（动态链接 ELF 文件的专属段，用于存储动态链接器的路径）</td>
</tr>
<tr>
<td><strong>程序入口执行逻辑</strong></td>
<td>execve 调用后，直接执行自身 <code>_start</code></td>
<td>先执行动态链接器（加载共享库、解析符号），再跳转到自身 <code>_start</code></td>
</tr>
<tr>
<td><strong>库更新</strong></td>
<td>需重新编译链接</td>
<td>库更新后无需重新编译</td>
</tr>
<tr>
<td><strong>内存占用</strong></td>
<td>多个程序使用同一库时重复加载</td>
<td>库仅加载一次，多程序共享</td>
</tr>
</tbody>
</table>
<details class="info">
<summary>静态链接 ELF 程序的启动流程示意图</summary>
<p><img src="/sys2/images/image6-9.png" style="display: block; width: 90%; margin: 0 auto;" /></p>
</details>
<details class="info">
<summary>动态链接 ELF 程序的启动流程示意图</summary>
<p><img src="/sys2/images/image6-10.png" style="display: block; width: 90%; margin: 0 auto;" /></p>
</details>
<details class="question">
<summary>思考</summary>
<div class="highlight"><pre><span></span><code><span class="err">120</span><span class="w"> </span><span class="err">000000000000063</span><span class="nf">a</span><span class="w"> </span><span class="err">&lt;</span><span class="no">main</span><span class="err">&gt;</span><span class="p">:</span>
<span class="err">121</span><span class="w"> </span><span class="err">63</span><span class="nl">a:</span><span class="w"> </span><span class="err">55</span><span class="w">                    </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbp</span>
<span class="err">122</span><span class="w"> </span><span class="err">63</span><span class="nl">b:</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e5</span><span class="w">              </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rbp</span>
<span class="err">123</span><span class="w"> </span><span class="err">63</span><span class="nl">e:</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">3</span><span class="no">d</span><span class="w"> </span><span class="mi">9</span><span class="no">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x9f</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span><span class="nv">%rdi</span>
<span class="err">124</span><span class="w"> </span><span class="err">645:</span><span class="w"> </span><span class="nf">e8</span><span class="w"> </span><span class="no">c6</span><span class="w"> </span><span class="no">fe</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">        </span><span class="no">callq</span><span class="w">  </span><span class="mh">510</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
<span class="err">125</span><span class="w"> </span><span class="err">64</span><span class="nl">a:</span><span class="w"> </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">        </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span>
<span class="err">126</span><span class="w"> </span><span class="err">64</span><span class="nl">f:</span><span class="w"> </span><span class="err">5</span><span class="nf">d</span><span class="w">                    </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbp</span>
<span class="err">127</span><span class="w"> </span><span class="err">650:</span><span class="w"> </span><span class="nf">c3</span><span class="w">                    </span><span class="no">retq</span>
</code></pre></div>
<p>When is puts resolved?</p>
<details class="success">
<summary>答案</summary>
<p>动态链接采用延迟绑定（Lazy Binding）机制以减少程序启动时间和内存开销。</p>
<p>程序启动时，动态链接器仅初始化 PLT（过程链接表）/ GOT（全局偏移表）的占位条目，不会解析 <code>puts</code>等动态符号。</p>
<p><strong>首次调用 <code>puts</code> 时</strong>，会执行 <code>callq &lt;puts@plt&gt;</code> 触发动态链接器，查找 <code>puts</code> 在 <code>libc.so</code> 中的实际内存地址并更新 GOT 表，后续调用 <code>puts</code> 时会直接通过 GOT 表跳转到实际地址，无需重复解析。</p>
</details>
</details>
<details class="question">
<summary>Why Applications are Operating System Specific?</summary>
<ul>
<li>每个操作系统都有其独有的系统调用和文件格式，在一个系统上编译的应用程序通常无法在其他操作系统上运行</li>
<li>应用程序跨系统运行的方案<ol>
<li>使用 Python、Ruby 等解释型语言编写，依赖多系统通用的解释器</li>
<li>使用包含虚拟机的语言（如Java）编写应用，通过跨系统的虚拟机（JVM）承载应用运行</li>
<li>使用 C 等标准语言编写，在每个目标 OS 上单独编译并运行</li>
</ol>
</li>
<li><strong>应用程序二进制接口（ABI）</strong>相当于架构层面的 API，定义了特定架构、CPU 等环境下特定 OS 的二进制代码各组件的交互规则</li>
</ul>
</details>
<h2 id="6-os-design-and-implementation">6 OS Design and Implementation<a class="headerlink" href="#6-os-design-and-implementation" title="Permanent link">&para;</a></h2>
<h3 id="6-1">6. 1 设计目标与规范<a class="headerlink" href="#6-1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>用户目标与系统目标</strong></p>
<ul>
<li>用户目标：操作系统应便于使用、易于学习、可靠、安全且高效</li>
<li>系统目标：操作系统应便于设计、实现与维护，同时具备灵活性、可靠性、无差错性与高效性</li>
</ul>
</li>
<li>
<p><strong>策略与机制分离的原则</strong></p>
<ul>
<li>机制（How to do）负责实现核心功能</li>
<li>策略（What to do）负责决策，允许策略独立修改而不影响机制</li>
</ul>
<details class="example">
<summary>示例</summary>
<p>调度机制（如何切换进程）与调度策略（选择哪个进程）分离</p>
</details>
</li>
</ol>
<h3 id="6-2">6. 2 实现语言<a class="headerlink" href="#6-2" title="Permanent link">&para;</a></h3>
<ul>
<li>底层：汇编语言（硬件相关操作）</li>
<li>主体：C（高效、可移植）</li>
<li>系统程序：C/C++、Shell、Python、Perl等脚本语言</li>
<li>越高级的语言越容易<strong>移植（port）</strong>到其他硬件，但运行速度会更慢</li>
<li><strong>仿真技术（emulation）</strong>可以让操作系统在非原生硬件上运行</li>
</ul>
<h2 id="7-operating-system-structure">7 Operating System Structure<a class="headerlink" href="#7-operating-system-structure" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>简单结构</strong>：无明确分层，功能混合，实现简单，如 MS-DOS</li>
<li>
<p><strong>单体结构（Monolithic）</strong>：内核所有功能（文件系统、调度、内存管理）集成在一个地址空间，支持可加载模块，如 Unix、Linux</p>
<details class="info">
<summary>传统 UNIX 系统的结构示意图</summary>
<p><img src="/sys2/images/image6-11.png" style="display: block; width: 50%; margin: 0 auto;" /></p>
<ul>
<li>受硬件功能的限制，原始 UNIX 操作系统的结构化程度较低，由两个可分离的部分组成：<ul>
<li><strong>系统程序</strong></li>
<li><strong>内核</strong>：包含系统调用接口之下、物理硬件之上的所有内容，提供文件系统、CPU 调度、内存管理及其他操作系统功能，在单一层级中集成了大量功能</li>
</ul>
</li>
</ul>
</details>
<details class="info">
<summary>Linux 系统的结构示意图</summary>
<p><img src="/sys2/images/image6-12.png" style="display: block; width: 35%; margin: 0 auto;" /></p>
</details>
</li>
<li>
<p><strong>分层结构（Layered）</strong></p>
<ul>
<li>操作系统被划分为若干个层（级别），每一层都构建在更低层级的基础之上，其中最底层（第 0 层）是硬件，最高层（第 N 层）是用户接口</li>
<li>借助模块化特性，每一层仅使用更低层级的功能（操作）与服务</li>
</ul>
<details class="info">
<summary>分层结构示意图</summary>
<p><img src="/sys2/images/image6-13.png" style="display: block; width: 35%; margin: 0 auto;" /></p>
</details>
</li>
<li>
<p><strong>微内核结构（Microkernel）</strong></p>
<ul>
<li>内核仅保留最核心功能（进程间通信、地址空间管理），其他功能移至用户态，如 Mach</li>
<li>用户模块之间通过<strong>消息传递</strong>进行通信</li>
<li>优势：更容易扩展微内核，更容易将操作系统移植到新架构，更可靠（在内核模式下运行的代码更少），更安全</li>
<li>劣势：用户空间与内核空间通信带来的性能开销</li>
</ul>
<details class="info">
<summary>微内核的系统结构示意图</summary>
<p><img src="/sys2/images/image6-14.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
</details>
</li>
<li>
<p><strong>模块结构（Modular）</strong></p>
<ul>
<li><strong>可加载内核模块（LKMs）</strong>：采用面向对象的方法，每个核心组件都是独立的，通过已知接口与其他组件通信，并可根据内核中的实际需求进行加载</li>
<li>与分层结构类似，但灵活性更高，Linux、Solaris 等系统都采用了这种方式</li>
</ul>
</li>
<li>
<p><strong>混合结构（Hybrid）</strong>：结合多种设计方法以满足性能、安全性、可用性方面的需求，是大多数现代 OS 的实现方式</p>
</li>
</ol>
<details class="example">
<summary>主流 OS 架构</summary>
<ul>
<li><strong>Linux</strong> 与 <strong>Solaris</strong>：内核运行在内核地址空间中（属于单体结构），同时加入了模块化设计以实现功能的动态加载</li>
<li><strong>Windows</strong>：主要采用单体结构，同时结合了微内核来实现不同子系统的特性</li>
<li><strong>Mac OS X</strong> ：混合分层架构，包含 Aqua 用户界面与 Cocoa 编程环境，其底层内核由 Mach 微内核、BSD Unix 组件构成，同时包含 I/O 工具包与可动态加载的模块（称为<strong>内核扩展</strong>）</li>
</ul>
<details class="info">
<summary>macOS 与 iOS 的系统结构示意图</summary>
<p><img src="/sys2/images/image6-15.png" style="display: block; width: 40%; margin: 0 auto;" /></p>
</details>
<ul>
<li>Android：<ul>
<li>栈结构与 iOS 类似</li>
<li>基于 Linux 内核进行修改：提供进程、内存、设备驱动管理功能，新增电源管理功能</li>
<li>运行时环境包含核心库集合与 Dalvik 虚拟机，应用程序基于 Java 语言结合 Android API 开发，Java 类文件先编译为 Java 字节码，再转换为可执行文件，随后在 Dalvik 虚拟机中运行</li>
<li>库包含网页浏览器（WebKit）、数据库（SQLite）、多媒体等框架，以及精简版的 libc 库</li>
</ul>
</li>
</ul>
<details class="info">
<summary>Android 的系统结构示意图</summary>
<p><img src="/sys2/images/image6-16.png" style="display: block; width: 40%; margin: 0 auto;" /></p>
</details>
<ul>
<li><strong>openEuler</strong>：华为开源的基于 Linux 的服务器 OS，支持模块化扩展</li>
</ul>
</details>
<h2 id="8-building-and-booting-an-operating-system">8 Building and Booting an Operating System<a class="headerlink" href="#8-building-and-booting-an-operating-system" title="Permanent link">&para;</a></h2>
<h3 id="8-1-linux">8. 1 构建流程（以 Linux 为例）<a class="headerlink" href="#8-1-linux" title="Permanent link">&para;</a></h3>
<ol>
<li>下载源码：从 kernel.org 获取内核源码</li>
<li>配置内核：<code>make menuconfig</code>（图形化配置核心功能与模块）</li>
<li>编译内核：<code>make</code>（生成内核镜像 <code>vmlinuz</code>）</li>
<li>编译模块：<code>make modules</code>（编译可加载模块）</li>
<li>安装模块：<code>make modules_install</code>（将模块安装到内核镜像）</li>
<li>安装内核：<code>make install</code>（将新内核添加到系统启动项）</li>
</ol>
<h3 id="8-2">8. 2 启动流程<a class="headerlink" href="#8-2" title="Permanent link">&para;</a></h3>
<ol>
<li>启动触发：系统通电初始化，程序从固定内存地址开始执行</li>
<li>硬件识别：执行 ROM/EEPROM 中的 BIOS/UEFI，定位内核，将其加载到内存并启动</li>
<li>引导加载：BIOS/UEFI 加载引导加载器（如支持多磁盘、多内核版本、多内核选项的启动选择的 GRUB）；有时是 ROM 代码先加载固定位置的引导块，再由引导块从磁盘加载引导加载程序（通常支持多种启动状态，例如单用户模式）</li>
<li>系统启动：内核加载完成后，系统开始运行</li>
</ol>
<h2 id="9-operating-system-debugging">9 Operating System Debugging<a class="headerlink" href="#9-operating-system-debugging" title="Permanent link">&para;</a></h2>
<details class="quote">
<summary>Kernighan’s Law</summary>
<p>Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as cleverly as possible, you are, by definition, not smart enough to debug it.</p>
</details>
<ol>
<li>
<p><strong>调试文件类型</strong></p>
<ul>
<li><strong>日志文件（log files）</strong>：记录系统错误信息、进程运行状态</li>
<li><strong>核心转储（Core Dump）</strong>：<strong>程序崩溃</strong>时保存<strong>进程内存</strong>镜像，用于事后调试</li>
<li><strong>崩溃转储（Crash Dump）</strong>：<strong>OS 崩溃</strong>时保存<strong>内核内存</strong>镜像</li>
</ul>
</li>
<li>
<p><strong>性能调优（performance tuning）</strong></p>
<ul>
<li>对指令指针进行周期性采样，以查找统计趋势，目标是通过消除瓶颈来提升性能</li>
<li>操作系统必须提供计算并展示系统行为指标的方式，如 Linux 的 <code>top</code> 程序或 Windows 任务管理器</li>
</ul>
</li>
<li>
<p><strong>跟踪（tracing）</strong></p>
<ul>
<li>收集特定事件的数据，比如系统调用触发过程中的各个步骤</li>
<li>工具：<code>strace</code>（跟踪进程所调用的系统调用）、<code>gdb</code>（源代码级调试器）、<code>perf</code>（Linux性能分析）、<code>tcpdump</code>（网络包捕获）</li>
</ul>
</li>
</ol>
<details class="info">
<summary>Linux bcc/BPF 跟踪工具的架构示意图</summary>
<p><img src="/sys2/images/image6-17.png" style="display: block; width: 65%; margin: 0 auto;" /></p>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/mathjax-config.js"></script>
      
    
  </body>
</html>