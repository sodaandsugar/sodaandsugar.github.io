
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2/">
      
      
        <link rel="next" href="../4/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Chapter 3 Hazard of Pipelining - sodasugar的笔记本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-3-hazard-of-pipelining" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="sodasugar的笔记本" class="md-header__button md-logo" aria-label="sodasugar的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            sodasugar的笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 3 Hazard of Pipelining
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="sodasugar的笔记本" class="md-nav__button md-logo" aria-label="sodasugar的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    sodasugar的笔记本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    通识课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            通识课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    大物乙Ⅱ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            大物乙Ⅱ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/%E7%89%A9%E7%90%86%E5%AD%A6%E5%8D%95%E4%BD%8D%E6%8D%A2%E7%AE%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    物理学单位换算
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter1_%E9%9D%99%E7%94%B5%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1 静电场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter2_%E9%9D%99%E7%94%B5%E5%9C%BA%E4%B8%AD%E7%9A%84%E5%AF%BC%E4%BD%93%E5%92%8C%E7%94%B5%E4%BB%8B%E8%B4%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2 静电场中的导体和电介质
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter3_%E7%94%B5%E6%B5%81%E5%92%8C%E7%A3%81%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3 电流和磁场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter4_%E7%89%A9%E8%B4%A8%E4%B8%AD%E7%9A%84%E7%A3%81%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4 物质中的磁场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter5_%E7%94%B5%E7%A3%81%E6%84%9F%E5%BA%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5 电磁感应
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter6_%E9%BA%A6%E5%85%8B%E6%96%AF%E9%9F%A6%E6%96%B9%E7%A8%8B%E4%B8%8E%E7%94%B5%E7%A3%81%E6%B3%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6 麦克斯韦方程与电磁波
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter7_%E5%85%89%E7%9A%84%E5%B9%B2%E6%B6%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7 光的干涉
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter8_%E5%85%89%E7%9A%84%E8%A1%8D%E5%B0%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8 光的衍射
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/Chapter9_%E5%85%89%E7%9A%84%E5%81%8F%E6%8C%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 9 光的偏振
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 10 光的量子论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 11 玻尔的原子模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 12 量子力学初步
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics2/midterm_review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中小结
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    专业课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            专业课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    数据安全与密码学基础
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            数据安全与密码学基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/resource/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    资源索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1 概论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2 完善保密加密
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3 对称密钥加密以及伪随机性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4 消息鉴别码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5 哈希函数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cryptography/midterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中考试卷
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            高级数据结构与算法分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/resource/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    资源索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    题目集
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            题目集
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AVL 树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Splay 树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    摊还分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    红黑树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    B+ 树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    倒排索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    左偏堆
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    斜堆
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    二项队列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    回溯
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分治法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    动态规划
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    贪心算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P/NP 问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    近似算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    局部搜索
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    随机算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并行算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Problem_Set/19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    外部排序
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中考 cheat sheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/midterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    期中考试
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    计算机系统Ⅱ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            计算机系统Ⅱ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1 ISA Review
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2 Design of Pipelining
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 3 Hazard of Pipelining
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 3 Hazard of Pipelining
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-structural-hazards" class="md-nav__link">
    <span class="md-ellipsis">
      1 结构冒险（Structural Hazards）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-hazards" class="md-nav__link">
    <span class="md-ellipsis">
      2 数据冒险（Data Hazards）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 数据冒险（Data Hazards）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      2. 1 转发（Forwarding）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-stall" class="md-nav__link">
    <span class="md-ellipsis">
      2. 2 Stall 机制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-control-harzards" class="md-nav__link">
    <span class="md-ellipsis">
      3 控制冒险（Control Harzards）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 控制冒险（Control Harzards）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-stall" class="md-nav__link">
    <span class="md-ellipsis">
      3. 1 Stall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      3. 2 Prediction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-delayed-decision" class="md-nav__link">
    <span class="md-ellipsis">
      3. 3 Delayed Decision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4-reducing-branch-delay" class="md-nav__link">
    <span class="md-ellipsis">
      3. 4 Reducing Branch Delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-5-branch-target-buffers-btb" class="md-nav__link">
    <span class="md-ellipsis">
      3. 5 分支目标缓冲区（Branch-Target Buffers, BTB）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-6-integrated-instruction-fetch-units" class="md-nav__link">
    <span class="md-ellipsis">
      3. 6 集成指令取指单元（Integrated Instruction Fetch Units）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-scheduling-of-nonlinear-pipelining" class="md-nav__link">
    <span class="md-ellipsis">
      4 非线性流水线的调度（Scheduling of Nonlinear pipelining）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-multiple-issue" class="md-nav__link">
    <span class="md-ellipsis">
      5 多发射（Multiple Issue）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 多发射（Multiple Issue）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-1" class="md-nav__link">
    <span class="md-ellipsis">
      5. 1 发射结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-2-speculation" class="md-nav__link">
    <span class="md-ellipsis">
      5. 2 Speculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-multiple-issue-processor" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3 多发射处理器（multiple-issue processor）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. 3 多发射处理器（multiple-issue processor）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-3-1-superscalar" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3. 1 超标量（Superscalar）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-2-vliw-very-long-instruction-word" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3. 2 超长指令字（VLIW, Very Long Instruction Word）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-3-super-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3. 3 超级流水线（Super-Pipeline）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4 Software-Hardware Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5 Intro&Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6 Structures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7 Processes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8 CPU Scheduling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 9 Synchronization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    选修课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            选修课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    英语口译
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            英语口译
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 Ceremonial Speech
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Tourism
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 Culture and Education
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 International Reports
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interpret/text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课堂文本
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-structural-hazards" class="md-nav__link">
    <span class="md-ellipsis">
      1 结构冒险（Structural Hazards）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-hazards" class="md-nav__link">
    <span class="md-ellipsis">
      2 数据冒险（Data Hazards）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 数据冒险（Data Hazards）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      2. 1 转发（Forwarding）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-stall" class="md-nav__link">
    <span class="md-ellipsis">
      2. 2 Stall 机制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-control-harzards" class="md-nav__link">
    <span class="md-ellipsis">
      3 控制冒险（Control Harzards）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 控制冒险（Control Harzards）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-stall" class="md-nav__link">
    <span class="md-ellipsis">
      3. 1 Stall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      3. 2 Prediction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-delayed-decision" class="md-nav__link">
    <span class="md-ellipsis">
      3. 3 Delayed Decision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4-reducing-branch-delay" class="md-nav__link">
    <span class="md-ellipsis">
      3. 4 Reducing Branch Delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-5-branch-target-buffers-btb" class="md-nav__link">
    <span class="md-ellipsis">
      3. 5 分支目标缓冲区（Branch-Target Buffers, BTB）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-6-integrated-instruction-fetch-units" class="md-nav__link">
    <span class="md-ellipsis">
      3. 6 集成指令取指单元（Integrated Instruction Fetch Units）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-scheduling-of-nonlinear-pipelining" class="md-nav__link">
    <span class="md-ellipsis">
      4 非线性流水线的调度（Scheduling of Nonlinear pipelining）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-multiple-issue" class="md-nav__link">
    <span class="md-ellipsis">
      5 多发射（Multiple Issue）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 多发射（Multiple Issue）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-1" class="md-nav__link">
    <span class="md-ellipsis">
      5. 1 发射结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-2-speculation" class="md-nav__link">
    <span class="md-ellipsis">
      5. 2 Speculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-multiple-issue-processor" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3 多发射处理器（multiple-issue processor）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. 3 多发射处理器（multiple-issue processor）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-3-1-superscalar" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3. 1 超标量（Superscalar）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-2-vliw-very-long-instruction-word" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3. 2 超长指令字（VLIW, Very Long Instruction Word）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-3-super-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      5. 3. 3 超级流水线（Super-Pipeline）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-3-hazard-of-pipelining">Chapter 3 Hazard of Pipelining<a class="headerlink" href="#chapter-3-hazard-of-pipelining" title="Permanent link">&para;</a></h1>
<h2 id="1-structural-hazards">1 结构冒险（Structural Hazards）<a class="headerlink" href="#1-structural-hazards" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>问题</strong>：流水线中的两条或多条指令竞争对单一物理资源的访问</li>
<li><strong>解决方案</strong>：<ul>
<li>指令轮流使用资源，一些指令不得不暂停</li>
<li>给机器添加更多硬件（通过添加更多硬件，总能解决结构冒险）</li>
</ul>
</li>
</ul>
<p><img src="/sys2/images/image3-1.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<h2 id="2-data-hazards">2 数据冒险（Data Hazards）<a class="headerlink" href="#2-data-hazards" title="Permanent link">&para;</a></h2>
<p>当指令间存在数据依赖时，若前一条指令还未完成数据的读 / 写，后续指令就需要等待，导致流水线停顿，效率下降。</p>
<p><img src="/sys2/images/image3-2.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<h3 id="2-1-forwarding">2. 1 转发（Forwarding）<a class="headerlink" href="#2-1-forwarding" title="Permanent link">&para;</a></h3>
<p>转发（Forwarding）通过额外硬件提前从流水线的内部寄存器中获取所需数据，减少了等待时间。</p>
<p>若前一条指令是算术逻辑运算（如 <code>add</code>、<code>sub</code>、<code>and</code> 等），其结果在 EX 阶段就可以获取，此时后续指令可直接从 EX/MEM 寄存器中转发结果，无需等待 WB 阶段。</p>
<p><img src="/sys2/images/image3-3.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<p>然而，转发无法解决所有流水线停顿，若前一条指令是 <code>load</code> ，其有效数据要到 MEM 阶段才可用，后续依赖该数据的指令仍需停顿。</p>
<p><img src="/sys2/images/image3-4.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<ul>
<li><strong>EX Hazard</strong>：若 <code>EX/MEM.RegWrite = 1 &amp;&amp; EX/MEM.Rd ≠ 0</code>，且 <code>EX/MEM.Rd = ID/EX.Rs1/Rs2</code>，则 <code>ForwardA/B = 10</code>，从前一条 ALU 指令的结果转发操作数</li>
<li><strong>MEM Harzard</strong>：若 <code>MEM/WB.RegWrite = 1 &amp;&amp; MEM/WB.Rd ≠ 0 &amp;&amp; not(EX Hazard)</code>，且 <code>MEM/WB.Rd = ID/EX.Rs1/Rs2</code>，则 <code>ForwardA/B = 01</code>，从内存数据或更早的 ALU 结果转发操作数</li>
<li><strong>Load-Use Hazard</strong>：若 <code>ID/EX.MemRead = 1</code> 且 <code>ID/EX.Rd = IF/ID.Rs1/Rs2</code>，需要让流水线停顿并插入气泡（空指令）</li>
</ul>
<p><img src="/sys2/images/image3-5.png" style="display: block; width: 85%; margin: 0 auto;" /></p>
<h3 id="2-2-stall">2. 2 Stall 机制<a class="headerlink" href="#2-2-stall" title="Permanent link">&para;</a></h3>
<p><code>nop</code> 指令表示 <code>ADDI x0,x0,0</code>，相当于空指令，可用于 stall 机制</p>
<p><img src="/sys2/images/image3-6.png" style="display: block; width: 85%; margin: 0 auto;" /></p>
<p><br></p>
<ul>
<li>将 ID/EX 寄存器中的控制值强制置 0<ul>
<li>EX、MEM 和 WB 阶段执行空操作（nop）</li>
</ul>
</li>
<li>阻止 PC，IF/ID 寄存器及 ID/EX 寄存器的更新<ul>
<li>当前使用的指令被再次解码</li>
<li>后续的指令被再次取指</li>
<li>1 个周期的停顿使 MEM 阶段能够为 <code>ld</code> 指令读取数据，随后可以 forward到 EX 阶段</li>
</ul>
</li>
</ul>
<p><img src="/sys2/images/image3-7.png" style="display: block; width: 85%; margin: 0 auto;" /></p>
<ul>
<li>stall 会降低性能，但为了得到正确结果，stall 是必需的</li>
<li>编译器可调整代码以避免冒险和停顿</li>
</ul>
<h2 id="3-control-harzards">3 控制冒险（Control Harzards）<a class="headerlink" href="#3-control-harzards" title="Permanent link">&para;</a></h2>
<p>当程序的执行流依赖于前一条指令（通常是分支指令）时，在分支结果确定前，流水线无法确定下一条该取哪条指令，从而引发冒险。</p>
<h3 id="3-1-stall">3. 1 Stall<a class="headerlink" href="#3-1-stall" title="Permanent link">&para;</a></h3>
<p>假设分支结果在 MEM 阶段确认，若直接 stall，等待分支结果确定后再取后续指令，这会造成 3 个时钟周期的浪费。</p>
<p><img src="/sys2/images/image3-8.png" style="display: block; width: 95%; margin: 0 auto;" /></p>
<p>为了减少分支指令导致的流水线停顿，在 RISC-V 流水线中，需要在 ID 阶段添加硬件，提前对分支指令进行判断：</p>
<ul>
<li><strong>目标地址加法器（Target address adder）</strong>：用于计算分支的目标地址（如 PC 值加上指令中的偏移量）</li>
<li><strong>寄存器比较器（Register comparator）</strong>：用于比较两个寄存器的值，从而判断分支条件是否满足</li>
</ul>
<p><img src="/sys2/images/image3-9.png" style="display: block; width: 90%; margin: 0 auto;" /></p>
<p>但是硬件依然需一定的操作时间，流水线依然需要等待这些操作完成才能确定下一条指令，这说明<strong>硬件优化虽然能缓解停顿，但无法完全消除停顿</strong>。</p>
<h3 id="3-2-prediction">3. 2 Prediction<a class="headerlink" href="#3-2-prediction" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>类别</th>
<th>定义</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Simple Prediction</strong></td>
<td><strong>总是</strong>预测条件分支不发生跳转</td>
<td><img src="/sys2/images/image3-10.png" width="500" style="display:block;margin:auto;"></td>
</tr>
<tr>
<td><strong>Sophisticated Prediction</strong></td>
<td>预测<strong>某些</strong>条件分支不发生跳转</td>
<td><img src="/sys2/images/image3-11.png" width="500" style="display:block;margin:auto;"></td>
</tr>
<tr>
<td><strong>Dynamic Prediction</strong></td>
<td>利用<strong>近期的历史行为</strong>来预测未来预测<strong>某些</strong>条件分支不发生跳转</td>
<td><img src="/sys2/images/image3-12.png" width="500" style="display:block;margin:auto;"></td>
</tr>
</tbody>
</table>
<p>若流水线更长，则提前确定分支结果是困难的，stall 造成的时钟周期浪费也是无法接受的。</p>
<p>通过提前预测分支的结果让流水线继续并行执行后续指令，只有当预测错误时才插入 stall 来刷新错误指令流，这样在预测正确的情况下流水线就无需 stall，能够大幅减少因等待分支结果导致的性能损失。</p>
<p>在 RISC-V 流水线中，我们采用 <strong>分支不发生跳转</strong> 的预测策略，流水线会无延迟地按顺序执行的逻辑取指，只有当预测错误时才会触发 stall，纠正指令流。</p>
<h3 id="3-3-delayed-decision">3. 3 Delayed Decision<a class="headerlink" href="#3-3-delayed-decision" title="Permanent link">&para;</a></h3>
<p>在延迟分支指令之后，立即放置一条 <strong>不受分支结果影响</strong> 的指令</p>
<p><img src="/sys2/images/image3-13.png" style="display: block; width: 90%; margin: 0 auto;" /></p>
<p>无论分支是否发生，<strong>分支延迟槽中的指令（Delay slot i+1）一定会被执行</strong>，通过在流水线等待分支结果的同时执行无关指令，有效避免流水线空转，减少 bubble 带来的性能浪费</p>
<h3 id="3-4-reducing-branch-delay">3. 4 Reducing Branch Delay<a class="headerlink" href="#3-4-reducing-branch-delay" title="Permanent link">&para;</a></h3>
<p>根据以上，分支指令的结果判断提前到了 ID 阶段，故有数据冒险情况如下：</p>
<table>
<thead>
<tr>
<th>比较寄存器的依赖场景</th>
<th>停顿周期</th>
<th>示意图</th>
</tr>
</thead>
<tbody>
<tr>
<td>依赖前 2/3 条 ALU 指令的结果（可通过 Forward 解决）</td>
<td>0</td>
<td><img src="/sys2/images/image3-14.png" width="500" style="display:block;margin:auto;"></td>
</tr>
<tr>
<td>依赖前 1 条 ALU 指令或前 2 条 load 指令的结果</td>
<td>1</td>
<td><img src="/sys2/images/image3-15.png" width="500" style="display:block;margin:auto;"></td>
</tr>
<tr>
<td>依赖紧接的前 1 条 load 指令的结果</td>
<td>2</td>
<td><img src="/sys2/images/image3-16.png" width="500" style="display:block;margin:auto;"></td>
</tr>
</tbody>
</table>
<p>在更深的流水线和超标量流水线中，分支惩罚更为显著，我们通常采用动态预测。</p>
<div class="highlight"><pre><span></span><code><span class="nl">outer:</span><span class="w"> </span><span class="na">...</span><span class="w">     </span><span class="err">（外层循环起始处）</span>
<span class="nl">inner:</span><span class="w"> </span><span class="na">...</span><span class="w">     </span><span class="err">（内层循环起始处）</span>
<span class="w">    </span><span class="nf">beq</span><span class="w"> </span><span class="no">...</span><span class="p">,</span><span class="w"> </span><span class="no">...</span><span class="p">,</span><span class="w"> </span><span class="no">inner</span><span class="w">  </span><span class="err">（若条件满足则跳回内层循环）</span>
<span class="w">    </span><span class="na">...</span>
<span class="w">    </span><span class="nf">beq</span><span class="w"> </span><span class="no">...</span><span class="p">,</span><span class="w"> </span><span class="no">...</span><span class="p">,</span><span class="w"> </span><span class="no">outer</span><span class="w">  </span><span class="err">（若条件满足则跳回外层循环）</span>
</code></pre></div>
<p>对于上面这段代码，若使用 1-bit Predictor，则内层循环的分支会被错误预测两次；若换用 2-bit predictor，则内层循环的分支仅被错误预测一次，故我们通常使用的 <strong>分支历史表（Branch History Table）</strong> 如下：</p>
<p><img src="/sys2/images/image3-17.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<h3 id="3-5-branch-target-buffers-btb">3. 5 分支目标缓冲区（Branch-Target Buffers, BTB）<a class="headerlink" href="#3-5-branch-target-buffers-btb" title="Permanent link">&para;</a></h3>
<p>即使有预测器，仍然需要计算目标地址，发生分支（分支被执行）时会有1个周期的代价，因从我们引入<strong>分支目标缓冲区（Branch-Target Buffers, BTB）</strong></p>
<p><img src="/sys2/images/image3-18.png" style="display: block; width: 85%; margin: 0 auto;" /></p>
<ul>
<li>能够更快获取分支目标处的指令</li>
<li>可以一次性提供分支目标处的多条指令，对多处理器场景来说是必要的</li>
<li>有可能实现无延迟的无条件分支，或者有时实现无延迟的条件分支</li>
</ul>
<table>
<thead>
<tr>
<th>Is instruction in BTB?</th>
<th>Predict</th>
<th>Reality</th>
<th>Delay cycle</th>
</tr>
</thead>
<tbody>
<tr>
<td>Yes</td>
<td>Taken</td>
<td>Taken</td>
<td>0</td>
</tr>
<tr>
<td>Yes</td>
<td>Taken</td>
<td>Untaken</td>
<td>2</td>
</tr>
<tr>
<td>No</td>
<td></td>
<td>Taken</td>
<td>2</td>
</tr>
<tr>
<td>No</td>
<td></td>
<td>Untaken</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="3-6-integrated-instruction-fetch-units">3. 6 集成指令取指单元（Integrated Instruction Fetch Units）<a class="headerlink" href="#3-6-integrated-instruction-fetch-units" title="Permanent link">&para;</a></h3>
<ul>
<li>专用分支预测器：预测过程返回、间接跳转和循环分支</li>
<li>集成了若干功能（集成的分支预测、指令预取和指令存储器访问与缓冲）</li>
</ul>
<p><img src="/sys2/images/image3-19.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
<h2 id="4-scheduling-of-nonlinear-pipelining">4 非线性流水线的调度（Scheduling of Nonlinear pipelining）<a class="headerlink" href="#4-scheduling-of-nonlinear-pipelining" title="Permanent link">&para;</a></h2>
<p>在非线性流水线中，我们需要确定何时向流水线引入新任务才不会与之前进入流水线的任务发生冲突，调度流程一般为<strong>冲突向量分析→状态转移图构建→循环队列调度</strong>，最终目的是为了找到使指令平均间隔最短的调度方案，最大化流水线的吞吐量，提升其性能。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>以 5 阶段非线性流水线为例，首先有<strong>初始冲突向量（Initial conflict vector）<span class="arithmatex">\(C0=(10110001)\)</span></strong>，令 CCV = Current Conflict Vector</p>
<p><img src="/sys2/images/image3-20.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<p>接下来尝试进行调度，下面给出两种示例：
<img src="/sys2/images/image3-21.png" style="display: block; width: 80%; margin: 0 auto;" />
<img src="/sys2/images/image3-22.png" style="display: block; width: 70%; margin: 0 auto;" /></p>
<p>接下来作出<strong>状态转移图（State transition graph）</strong>：</p>
<p><img src="/sys2/images/image3-23.png" style="display: block; width: 60%; margin: 0 auto;" /></p>
<p>最后进行最短平均间隔分析：</p>
<p><img src="/sys2/images/image3-24.png" style="display: block; width: 40%; margin: 0 auto;" /></p>
</div>
<h2 id="5-multiple-issue">5 多发射（Multiple Issue）<a class="headerlink" href="#5-multiple-issue" title="Permanent link">&para;</a></h2>
<p>为了提升<strong>指令级并行（ILP, Instruction-Level Parallelism）</strong>，除了采用更深的流水线，减少每级的工作量从而缩短时钟周期外，还可以采用多发射。</p>
<p>多发射指的是复制流水线级形成多条流水线，每个时钟周期启动多条指令，由于 <span class="arithmatex">\(\text{CPI}&lt;1\)</span>，所以我们通常使用 <strong>每周期指令数（IPC）</strong> 作为衡量标准。</p>
<p><img src="/sys2/images/image3-25.png" style="display: block; width: 80%; margin: 0 auto;" /></p>
<h3 id="5-1">5. 1 发射结构<a class="headerlink" href="#5-1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>静态多发射（Static multiple issue）</th>
<th>动态多发射（Dynamic multiple issue）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>概念</strong></td>
<td><span class="arithmatex">\(\textbf{·}\)</span> <strong>编译器 (Compiler)</strong> 将待发射的指令分组并打包到 <strong>发射槽 (issue slots)</strong> <br> <span class="arithmatex">\(\textbf{·}\)</span> 使用编译器检测并避免冒险</td>
<td><span class="arithmatex">\(\textbf{·}\)</span> CPU 检查指令流并在每个周期选择要发射的指令 <br> <span class="arithmatex">\(\textbf{·}\)</span> 编译器可通过重排指令提供帮助 <br> <span class="arithmatex">\(\textbf{·}\)</span> CPU 在运行时使用高级技术解决冒险</td>
</tr>
</tbody>
</table>
<h3 id="5-2-speculation">5. 2 Speculation<a class="headerlink" href="#5-2-speculation" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>编译器推测</th>
<th>硬件推测</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>概念</strong></td>
<td><span class="arithmatex">\(\textbf{·}\)</span> 可以对指令重新排序，如将加载操作移到分支之前 <br> <span class="arithmatex">\(\textbf{·}\)</span> 可以包含修正指令，从而从错误猜测中恢复</td>
<td><span class="arithmatex">\(\textbf{·}\)</span> 可以预取待执行的指令 <br> <span class="arithmatex">\(\textbf{·}\)</span> 缓冲结果直到确定其被实际需要 <br> <span class="arithmatex">\(\textbf{·}\)</span> 在推测错误时清空缓冲区</td>
</tr>
</tbody>
</table>
<h3 id="5-3-multiple-issue-processor">5. 3 多发射处理器（multiple-issue processor）<a class="headerlink" href="#5-3-multiple-issue-processor" title="Permanent link">&para;</a></h3>
<h4 id="5-3-1-superscalar">5. 3. 1 超标量（Superscalar）<a class="headerlink" href="#5-3-1-superscalar" title="Permanent link">&para;</a></h4>
<ul>
<li>每个时钟周期发射的指令数<strong>不固定</strong>，取决于代码的具体情况（1-8条，存在上限）</li>
<li>假设上限为 <span class="arithmatex">\(n\)</span>，则该处理器称为 <span class="arithmatex">\(n\)</span> 发射处理器</li>
<li>可以通过编译器进行<strong>静态调度</strong>，也可以基于 Tomasulo 算法进行<strong>动态调度</strong></li>
<li>是目前通用计算中最成功的方法</li>
</ul>
<p><img src="/sys2/images/image3-26.png" style="display: block; width: 50%; margin: 0 auto;" /></p>
<ul>
<li>超标量结构对程序员完全透明：处理器自动检测指令是否可流出，无需手动重排指令</li>
<li>兼容性：未针对超标量优化的代码或旧编译器生成的代码仍然可以运行，但性能表现差</li>
<li>性能优化手段：采用<strong>动态超标量调度</strong>技术提升执行效率</li>
</ul>
<h4 id="5-3-2-vliw-very-long-instruction-word">5. 3. 2 超长指令字（VLIW, Very Long Instruction Word）<a class="headerlink" href="#5-3-2-vliw-very-long-instruction-word" title="Permanent link">&para;</a></h4>
<ul>
<li>每个时钟周期发射的指令数是 <strong>固定</strong> 的（4-16条），这些指令构成一条长指令或一个 <strong>指令包（instruction packet）</strong></li>
<li>在指令包中，指令之间的并行性通过指令<strong>显式</strong>表达</li>
<li>指令调度由编译器 <strong>静态</strong> 完成</li>
<li>应用于数字信号处理和多媒体应用领域</li>
</ul>
<p><img src="/sys2/images/image3-27.png" style="display: block; width: 50%; margin: 0 auto;" /></p>
<h4 id="5-3-3-super-pipeline">5. 3. 3 超级流水线（Super-Pipeline）<a class="headerlink" href="#5-3-3-super-pipeline" title="Permanent link">&para;</a></h4>
<ul>
<li>每个流水线阶段被进一步细分</li>
<li>多条指令可在一个时钟周期内分时共享</li>
<li>对于每时钟周期可流出 <span class="arithmatex">\(n\)</span> 条指令的超级流水线计算机，这 <span class="arithmatex">\(n\)</span> 条指令并非同时流出，而是每 <span class="arithmatex">\(1/n\)</span> 个时钟周期流出一条指令，其流水线周期实际为 <span class="arithmatex">\(1/n\)</span> 个时钟周期</li>
</ul>
<p><img src="/sys2/images/image3-28.png" style="display: block; width: 50%; margin: 0 auto;" /></p>
<table>
<thead>
<tr>
<th>通用名称</th>
<th>发射结构</th>
<th>冒险检测</th>
<th>调度</th>
<th>区分特征</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>超标量（静态）</strong></td>
<td>动态</td>
<td>硬件</td>
<td>静态</td>
<td>按序执行</td>
</tr>
<tr>
<td><strong>超标量（动态）</strong></td>
<td>动态</td>
<td>硬件</td>
<td>动态</td>
<td>部分乱序执行，但无推测</td>
</tr>
<tr>
<td><strong>超标量（推测型）</strong></td>
<td>动态</td>
<td>硬件</td>
<td>带推测的动态</td>
<td>带推测的乱序执行</td>
</tr>
<tr>
<td><strong>超长指令字/长指令字（VLIW/LIW）</strong></td>
<td>静态</td>
<td>主要靠软件</td>
<td>静态</td>
<td>所有冒险由编译器确定并指示（通常为隐式）</td>
</tr>
<tr>
<td><strong>显式并行指令计算（EPIC）</strong></td>
<td>主要为静态</td>
<td>主要靠软件</td>
<td>主要为静态</td>
<td>所有冒险由编译器显式确定并指示</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/mathjax-config.js"></script>
      
    
  </body>
</html>